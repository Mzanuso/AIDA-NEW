#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# AIDA-FLOW Pre-push Validation
echo "ğŸš€ Running pre-push validations..."

# Update test registry
echo "ğŸ“Š Updating test registry..."
npm run test:scan

# Run full validation
echo "ğŸ” Running full validation suite..."
npm run validate

# Run coverage check
echo "ğŸ“ˆ Checking test coverage..."
npm run test:coverage:check

# Check exit code
if [ $? -ne 0 ]; then
  echo "âŒ Pre-push validation failed!"
  echo "ğŸ’¡ Coverage must be at least 70%"
  echo "ğŸ’¡ Run 'npm run test:coverage' to see detailed report"
  exit 1
fi

echo "âœ… All pre-push validations passed!"
echo "ğŸš€ Push proceeding..."
